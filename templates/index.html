<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction Results</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <header>
            <h1>Cyber-Security Incident Response Platform</h1>
        </header>

        <!-- Buttons for Simulation and Prediction -->
        <div class="button-container">
            <button id="simulateBtn" onclick="runSimulation()">Run Simulation</button>
            <button id="predictBtn" onclick="runModelPrediction()">Run Model Prediction</button>
        </div>

        <div class="logs">
            <h2>Simulation Logs</h2>
            <ul>
                {% for log in simulation_logs %}
                <li>{{ log }}</li>
                {% endfor %}
            </ul>
        
            <h2>Model Logs</h2>
            <ul>
                {% for log in model_logs %}
                <li>{{ log }}</li>
                {% endfor %}
            </ul>
        </div>
        
        <!-- Incidents Overview Section -->
        <div class="main-content">
            <div class="section overview">
                <h2>Incidents Overview</h2>
                <p>Incidents Detected: {{ predictions|length }}</p>
                <p>Incidents Mitigated: {{ incidents_mitigated }}</p>
            </div>

            <!-- Bar Chart Section -->
            <div class="section">
                <h2>Incident Response</h2>
                <div id="bar-chart">
                    <canvas id="predictionChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Incident Logs Section -->
        <div class="incidents-log">
            <h2>Incident Logs</h2>
            <table class="table table-bordered mt-3" id="incidentTable">
                <thead>
                    <tr>
                        <th>Incident ID</th>
                        <th>Incident Type</th>
                        <th>Status</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody id="incidentTableBody">
                    {% for incident in incidents %}
                    <tr>
                        <td>{{ incident['id'] }}</td>
                        <td>{{ incident['type'] }}</td>
                        <td>{{ incident['status'] }}</td>
                        <td>{{ incident['timestamp'] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Prediction Details Section -->
        <div class="table-container section">
            <h2>Prediction Details</h2>
            <table id="predictionTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Actual Label</th>
                        <th>Predicted Label</th>
                    </tr>
                </thead>
                <tbody id="predictionTableBody">
                    {% for prediction in predictions %}
                    <tr>
                        <td>{{ prediction[0] }}</td>
                        <td>{{ prediction[1] }}</td>
                        <td>{{ prediction[2] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- DDoS Prediction Results Section -->
        <div class="table-container section">
            <h2>DDoS Prediction Results</h2>
            <table class="table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Traffic Rate</th>
                        <th>Prediction</th>
                    </tr>
                </thead>
                <tbody>
                    {% for prediction in predictions %}
                    <tr>
                        <td>{{ prediction.timestamp }}</td>
                        <td>{{ prediction.traffic_rate }}</td>
                        <td>{{ "Attack Detected" if prediction.prediction == 1 else "Normal Traffic" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Footer -->
        <footer>
            &copy; 2024 Cyber Security Platform
        </footer>
    </div>

    <!-- JavaScript for AJAX Calls -->
    <script>
        // Function to run the simulation
        function runSimulation() {
            fetch('/run-simulation')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('simulationOutput').innerText = data.message;
                    updateIncidentTable(data.incidents);
                })
                .catch(error => console.error('Error running simulation:', error));
        }

        // Function to run the model prediction
        function runModelPrediction() {
            fetch('/run-model-prediction')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('predictionOutput').innerText = data.message;
                    updatePredictionTable(data.predictions);
                })
                .catch(error => console.error('Error running model prediction:', error));
        }

        // Update Incident Table with new data
        function updateIncidentTable(incidents) {
            const incidentTableBody = document.getElementById('incidentTableBody');
            incidentTableBody.innerHTML = '';
            incidents.forEach(incident => {
                const row = `<tr>
                    <td>${incident.id}</td>
                    <td>${incident.type}</td>
                    <td>${incident.status}</td>
                    <td>${incident.timestamp}</td>
                </tr>`;
                incidentTableBody.insertAdjacentHTML('beforeend', row);
            });
        }

        // Update Prediction Table with new data
        function updatePredictionTable(predictions) {
            const predictionTableBody = document.getElementById('predictionTableBody');
            predictionTableBody.innerHTML = '';
            predictions.forEach(prediction => {
                const row = `<tr>
                    <td>${prediction.id}</td>
                    <td>${prediction.actual}</td>
                    <td>${prediction.predicted}</td>
                </tr>`;
                predictionTableBody.insertAdjacentHTML('beforeend', row);
            });
        }
    </script>
</body>
</html>
